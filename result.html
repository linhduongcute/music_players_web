<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Songs</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #searchContainer {
            position: relative;
            width: 300px;
        }
        #searchInput {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        #suggestions {
            position: absolute;
            width: 100%;
            background: white;
            border: 1px solid #ccc;
            border-top: none;
            max-height: 200px;
            overflow-y: auto;
            display: none;
            list-style: none;
            padding: 0;
            margin: 0;
        }
        #suggestions li {
            padding: 8px;
            cursor: pointer;
            border-bottom: 1px solid #ddd;
        }
        #suggestions li:hover {
            background: #f0f0f0;
        }
        #results {
            margin-top: 20px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>

    <h1>Search Songs</h1>
    <div id="searchContainer">
        <input type="text" id="searchInput" placeholder="Nh·∫≠p t√™n b√†i h√°t...">
        <ul id="suggestions"></ul>
    </div>

    <div id="results"></div>

    <script>
        // üî• K·∫øt n·ªëi Supabase (THAY URL v√† KEY c·ªßa b·∫°n v√†o ƒë√¢y)
        const supabaseClient = supabase.createClient(
            "https://SUPABASE_URL.supabase.co",
            "SUPABASE_ANON_KEY"
        );

        const searchInput = document.getElementById("searchInput");
        const suggestionsList = document.getElementById("suggestions");
        const resultsContainer = document.getElementById("results");

        searchInput.addEventListener("input", async function () {
            const inputText = this.value.toLowerCase();
            suggestionsList.innerHTML = "";

            if (inputText.length === 0) {
                suggestionsList.style.display = "none";
                return;
            }

            // üî• Fetch danh s√°ch b√†i h√°t t·ª´ Supabase
            const { data, error } = await supabaseClient
                .from("songs")
                .select("title, file_path")
                .ilike("title", `%${inputText}%`);

            if (error) {
                console.error("L·ªói khi l·∫•y d·ªØ li·ªáu:", error.message);
                return;
            }

            if (data.length === 0) {
                suggestionsList.style.display = "none";
                return;
            }

            data.forEach(song => {
                const li = document.createElement("li");
                li.textContent = song.title;
                li.addEventListener("click", function () {
                    // üîÄ Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang result.html
                    const songUrl = `result.html?title=${encodeURIComponent(song.title)}&file=${encodeURIComponent(song.file_path)}`;
                    window.location.href = songUrl;
                });
                suggestionsList.appendChild(li);
            });

            suggestionsList.style.display = "block";
        });

        // üìå Hi·ªÉn th·ªã k·∫øt qu·∫£ tr√™n trang khi nh·∫•n Enter
        searchInput.addEventListener("keydown", async function (event) {
            if (event.key === "Enter") {
                event.preventDefault();
                const inputText = searchInput.value.toLowerCase();

                if (inputText.length === 0) return;

                // üî• Fetch danh s√°ch b√†i h√°t
                const { data, error } = await supabaseClient
                    .from("songs")
                    .select("title, file_path")
                    .ilike("title", `%${inputText}%`);

                if (error) {
                    console.error("L·ªói khi l·∫•y d·ªØ li·ªáu:", error.message);
                    return;
                }

                resultsContainer.innerHTML = "";

                if (data.length === 0) {
                    resultsContainer.innerHTML = "<p>Kh√¥ng t√¨m th·∫•y b√†i h√°t n√†o.</p>";
                    return;
                }

                const ul = document.createElement("ul");
                data.forEach(song => {
                    const li = document.createElement("li");
                    li.innerHTML = `<strong>${song.title}</strong> - <a href="result.html?title=${encodeURIComponent(song.title)}&file=${encodeURIComponent(song.file_path)}">Nghe ngay</a>`;
                    ul.appendChild(li);
                });

                resultsContainer.appendChild(ul);
            }
        });

        // ·∫®n g·ª£i √Ω khi click ngo√†i v√πng t√¨m ki·∫øm
        document.addEventListener("click", function (event) {
            if (!searchInput.contains(event.target) && !suggestionsList.contains(event.target)) {
                suggestionsList.style.display = "none";
            }
        });
    </script>

</body>
</html>
